<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Products â€“ Vital Elixir Globalist</title>
  <meta name="description" content="Explore genuine medicines by category â€“ tablets, creams, drops, sprays and injections."
    />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: { colors: { brand: '#0284c7' } }
      }
    };
  </script>
</head>

<body class="text-gray-800 bg-gray-50">
  <!-- Header placeholder -->
  <div id="header-placeholder"></div>

  <!-- Page Title -->
  <section class="text-center py-10 bg-gradient-to-b from-blue-50 to-white">
    <h1 class="text-4xl font-extrabold text-gray-900">Our Medicines</h1>
    <p class="text-gray-600 mt-2">Explore by category and add to your cart for quick checkout</p>
  </section>

  <!-- Search & Category Filter -->
  <div
    class="max-w-6xl mx-auto px-4 mb-8 flex flex-col md:flex-row md:justify-between md:items-center gap-4">
    <input id="searchBar" type="text" placeholder="Search medicines..."
      class="w-full md:w-1/2 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-brand" />
    <select id="categoryFilter" class="border rounded p-2">
      <option value="all">All Categories</option>
      <option value="Menâ€™s Health">Menâ€™s Health</option>
      <option value="Diabetes & Metabolic Care">Diabetes & Metabolic Care</option>
      <option value="Dermatology & Skin Care">Dermatology & Skin Care</option>
      <option value="Eye & Allergy Care">Eye & Allergy Care</option>
      <option value="Hormonal & Thyroid Care">Hormonal & Thyroid Care</option>
      <option value="Hormonal / Performance Enhancement">Hormonal / Performance Enhancement</option>
      <option value="Infection & Antiparasitic Treatments">Infection & Antiparasitic Treatments</option>
      <option value="Neurology">Neurology</option>
      <option value="Thyroid Treatment">Thyroid Treatment</option>
      <option value="Allergy / Anxiety">Allergy / Anxiety</option>
      <option value="Anti-Malarial / Autoimmune">Anti-Malarial / Autoimmune</option>
      <option value="Addiction Treatment">Addiction Treatment</option>
      <option value="Anticoagulant">Anticoagulant</option>
      <option value="Veterinary / Other Uses">Veterinary / Other Uses</option>
      <option value="Veterinary / Antiparasitic">Veterinary / Antiparasitic</option>
      <option value="Hormone Therapy">Hormone Therapy</option>
      <option value="Supplement">Supplement</option>
      <option value="Allergy / Asthma">Allergy / Asthma</option>
    </select>
  </div>

  <!-- Product Grid -->
  <div id="productGrid"
    class="max-w-6xl mx-auto grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 px-4 pb-16"></div>

  <!-- Modal Overlay for alerts and confirmations -->
  <div id="modalOverlay"
    class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-xl p-6 max-w-sm w-full text-center shadow-lg">
      <h2 class="text-lg font-bold mb-4">Vital Elixir Globalist â€“ Our customers are most important to us.</h2>
      <p id="modalMessage" class="text-sm text-gray-700 mb-6"></p>
      <div class="flex justify-center gap-4">
        <button id="modalOk" class="bg-brand text-white px-4 py-2 rounded-lg hover:bg-blue-700">OK</button>
        <button id="modalProceed"
          class="hidden bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">Proceed
          to Cart</button>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="py-8 bg-white border-t text-center text-gray-600 text-sm">
    Â© <span id="year"></span> Vital Elixir Globalist. All rights reserved.
  </footer>

  <script>
    // Set footer year
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>

  <script>
    // Load header and menu
    async function loadHeader() {
      const header = await fetch('header.html');
      document.getElementById('header-placeholder').innerHTML = await header.text();
      // copy mobile menu functionality
      const menuBtn = document.getElementById('menu-btn');
      const closeBtn = document.getElementById('close-menu');
      const mobileMenu = document.getElementById('mobile-menu');
      const sidebar = document.getElementById('sidebar');
      if (!menuBtn || !sidebar || !mobileMenu) return;
      menuBtn.addEventListener('click', () => {
        mobileMenu.classList.remove('hidden');
        setTimeout(() => sidebar.classList.remove('translate-x-full'), 10);
      });
      closeBtn.addEventListener('click', () => {
        sidebar.classList.add('translate-x-full');
        setTimeout(() => mobileMenu.classList.add('hidden'), 300);
      });
      mobileMenu.addEventListener('click', (e) => {
        if (e.target === mobileMenu) {
          sidebar.classList.add('translate-x-full');
          setTimeout(() => mobileMenu.classList.add('hidden'), 300);
        }
      });
    }
    loadHeader();
  </script>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js';
    import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js';
    import { getFirestore, collection, addDoc } from 'https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js';

    // Firebase config
    const firebaseConfig = {
      apiKey: 'AIzaSyBsSrWpk0I6YnjNJcGRBnXg23WePsgdRx4',
      authDomain: 'vital-elixir-globalist.firebaseapp.com',
      projectId: 'vital-elixir-globalist',
      storageBucket: 'vital-elixir-globalist.appspot.com',
      messagingSenderId: '87028221342',
      appId: '1:87028221342:web:0c7719acc703566e8fc28f',
      measurementId: 'G-5MWKWE2C4J'
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let currentUser = null;
    onAuthStateChanged(auth, (user) => {
      currentUser = user;
    });

    // Modal functions
    const modalOverlay = document.getElementById('modalOverlay');
    const modalMessage = document.getElementById('modalMessage');
    const modalOk = document.getElementById('modalOk');
    const modalProceed = document.getElementById('modalProceed');
    function showModal(message, showProceed = false) {
      modalMessage.textContent = message;
      modalOverlay.classList.remove('hidden');
      if (showProceed) {
        modalProceed.classList.remove('hidden');
      } else {
        modalProceed.classList.add('hidden');
      }
    }
    function hideModal() {
      modalOverlay.classList.add('hidden');
    }
    modalOk.addEventListener('click', () => {
      hideModal();
    });
    modalProceed.addEventListener('click', () => {
      hideModal();
      window.location.href = 'cart.html';
    });

       const SHIPPING_USD = 35;
    let allProducts = [];
    const productGrid = document.getElementById('productGrid');
    const searchBar = document.getElementById('searchBar');
    const categoryFilter = document.getElementById('categoryFilter');

    function getSelectedCurrency() {
      return window.currencyUtils?.getSelectedCurrency?.() || 'GBP';
    }

    function formatForeignCurrency(value) {
      const currency = getSelectedCurrency();
      const converted = window.currencyUtils?.convertFromUsd
        ? window.currencyUtils.convertFromUsd(value, currency)
        : value;
      return `${currency} ${Number(converted || 0).toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}`;
    }

    async function loadProducts() {
      const res = await fetch('products-data.json');
      allProducts = await res.json();
    applyInitialFilters();
    }
    function displayProducts(products) {
      productGrid.innerHTML = '';
      products.forEach((p) => {
        const card = document.createElement('div');
        card.className = 'bg-white border rounded-xl p-4 shadow-sm hover:shadow-lg transition flex flex-col';
        const dropdownOptions = p.variants
          .map((v) => `<option value="${p.variants.indexOf(v)}">${v.pack} â€“ ${formatForeignCurrency(v.price_usd)}</option>`)
          .join('');
        card.innerHTML = `
          <img src="${p.image}" alt="${p.name}" class="w-full h-40 object-contain mb-3 rounded" />
          <h2 class="font-semibold text-lg text-brand">${p.name}</h2>
          <p class="text-sm text-gray-600">${p.brand}</p>
          <p class="text-sm text-gray-500 mb-2">${p.composition}</p>
          <p class="text-sm text-gray-600 mb-1"><strong>Use:</strong> ${p.use}</p>
          <a href="product-details.html?product=${encodeURIComponent(p.name)}" class="inline-flex items-center gap-1 text-sm text-brand font-semibold hover:underline">View details<span aria-hidden="true">â†’</span></a>
          <select class="variantSelect border mt-2 p-2 rounded w-full text-sm focus:ring-2 focus:ring-brand">
            <option disabled selected>Order Quantity</option>
            ${dropdownOptions}
          </select>
           <p class="mt-2 text-xs text-gray-500">Shipping: +${formatForeignCurrency(SHIPPING_USD)} (added per product)</p>
          <div class="price-display mt-3 text-sm text-gray-700"></div>
          <button class="add-to-cart-btn mt-auto bg-brand text-white py-2 px-3 rounded-lg hover:bg-blue-700 transition mt-3">Add to Cart</button>
        `;
        const select = card.querySelector('.variantSelect');
        const priceDisplay = card.querySelector('.price-display');
        const addBtn = card.querySelector('.add-to-cart-btn');
          select.addEventListener('change', (e) => {
          const variant = p.variants[e.target.value];
                const shippingInr = variant.price_usd > 0 ? (variant.price_inr / variant.price_usd) * SHIPPING_USD : 0;
          const totalUsd = variant.price_usd + SHIPPING_USD;
          const totalInr = variant.price_inr + shippingInr;
          priceDisplay.innerHTML = `
            <div class="mt-2 p-2 border border-blue-100 rounded-lg bg-blue-50 text-sm space-y-1">
              <p>ðŸ’Š <span class="font-medium text-brand">Medicine:</span> ${formatForeignCurrency(variant.price_usd)} | INR ${variant.price_inr.toFixed(2)}</p>
              <p>ðŸšš <span class="font-medium text-brand">Shipping:</span> ${formatForeignCurrency(SHIPPING_USD)} | INR ${shippingInr.toFixed(2)}</p>
              <p class="font-semibold text-brand">Total: ${formatForeignCurrency(totalUsd)} | INR ${totalInr.toFixed(2)}</p>
            </div>
          `;
        });
        addBtn.addEventListener('click', async () => {
          const variantIndex = select.selectedIndex - 1;
          if (variantIndex < 0) {
            showModal('Please select a quantity before adding to cart.');
            return;
          }
          if (!currentUser) {
            // Not logged in
            showModal('Please log in to add items to your cart.', false);
            // Redirect to login after closing modal
            modalOk.onclick = () => {
              hideModal();
              window.location.href = 'login.html?redirect=products.html';
            };
            return;
          }
          // Add to local cart (for quick display)
         const selectedVariant = p.variants[variantIndex];
          const shippingInr = selectedVariant.price_usd > 0 ? (selectedVariant.price_inr / selectedVariant.price_usd) * SHIPPING_USD : 0;
          const totalUsd = selectedVariant.price_usd + SHIPPING_USD;
          const totalInr = selectedVariant.price_inr + shippingInr;
          const cart = JSON.parse(localStorage.getItem('cart')) || [];
          cart.push({
            name: p.name,
            brand: p.brand,
            pack: selectedVariant.pack,
            price_usd: selectedVariant.price_usd,
            price_inr: selectedVariant.price_inr,
            shipping_usd: SHIPPING_USD,
            shipping_inr: parseFloat(shippingInr.toFixed(2)),
           total_price_usd: Math.round(totalUsd),
            total_price_inr: parseFloat(totalInr.toFixed(2)),
            image: p.image
          });
          localStorage.setItem('cart', JSON.stringify(cart));
          // Save to Firestore under user cart subcollection
          try {
            await addDoc(collection(db, 'users', currentUser.uid, 'cart'), {
              name: p.name,
              brand: p.brand,
              pack: selectedVariant.pack,
              price_usd: selectedVariant.price_usd,
              price_inr: selectedVariant.price_inr,
              shipping_usd: SHIPPING_USD,
              shipping_inr: parseFloat(shippingInr.toFixed(2)),
             total_price_usd: Math.round(totalUsd),
              total_price_inr: parseFloat(totalInr.toFixed(2)),
              image: p.image,
              dateAdded: new Date().toISOString()
            });
          } catch (error) {
            console.error('Error adding to Firestore cart:', error);
          }
          showModal(`${p.name} (${selectedVariant.pack}) added to cart.`, true);
        });
        productGrid.appendChild(card);
      });
    }
 function filterProducts() {
      const query = searchBar.value.toLowerCase();
      const category = categoryFilter.value;
      const filtered = allProducts.filter((p) =>
        (category === 'all' || p.category === category) &&
        (p.name.toLowerCase().includes(query) || p.brand.toLowerCase().includes(query))
      );
      displayProducts(filtered);
    }
    function applyInitialFilters() {
      const params = new URLSearchParams(window.location.search);
      const categoryParam = params.get('category');
      const searchParam = params.get('search') || params.get('q');

      if (categoryParam) {
        const decodedCategory = decodeURIComponent(categoryParam);
        const hasOption = Array.from(categoryFilter.options).some((opt) => opt.value === decodedCategory);
        categoryFilter.value = hasOption ? decodedCategory : 'all';
      }

      if (searchParam) {
        searchBar.value = decodeURIComponent(searchParam);
      }

      filterProducts();

      if ((categoryParam || searchParam) && productGrid) {
        productGrid.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }
       searchBar.addEventListener('input', filterProducts);
    categoryFilter.addEventListener('change', filterProducts);
    document.addEventListener('currency:change', filterProducts);
    loadProducts();
  </script>
  <script type="module" src="firebase-config.js"></script>
</body>
</html>







