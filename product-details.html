<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Medicine Details – Vital Elixir Globalist</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script>
    tailwind.config = {
      theme: { extend: { colors: { brand: "#0284c7" } } },
    };
  </script>
</head>

<body class="bg-gray-50 text-gray-800">
  <!-- Header Placeholder -->
  <div id="header-placeholder"></div>

  <!-- Product Details Section -->
  <section class="max-w-5xl mx-auto py-16 px-6 grid md:grid-cols-2 gap-10" id="productDetails">
    <div>
      <img id="product-image" src="" alt="Medicine Image" class="rounded-2xl shadow-lg w-full" />
    </div>

    <div>
      <h1 id="product-name" class="text-3xl font-bold text-gray-900 mb-2"></h1>
      <p id="product-brand" class="text-gray-600 mb-2"></p>
      <p id="product-composition" class="text-gray-600 mb-2"></p>
      <p id="product-description" class="text-gray-700 mb-6"></p>

      <!-- Dynamic Variant Prices -->
      <div id="product-variants" class="space-y-3 mb-6"></div>

      <div class="flex gap-4">
        <button
          onclick="addToCart()"
          class="px-6 py-3 bg-brand text-white rounded-xl hover:bg-blue-700"
        >
          Add to Cart
        </button>
        <button
          onclick="buyNow()"
          class="px-6 py-3 border border-brand rounded-xl hover:bg-blue-50"
        >
          Buy Now
        </button>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="py-10 bg-white border-t text-center text-gray-600 text-sm">
    © <span id="year"></span> Vital Elixir Globalist. All rights reserved.
  </footer>

  <script>
    // Footer Year
    document.getElementById("year").textContent = new Date().getFullYear();

    let selectedProduct = null;

    // Load Product Details from JSON
    async function loadProductDetails() {
      try {
        const params = new URLSearchParams(window.location.search);
        const productName = decodeURIComponent(params.get("product"));

        const res = await fetch("data/products-data.json");
        const products = await res.json();

        const product = products.find((p) => p.name === productName);

        if (!product) {
          document.getElementById("productDetails").innerHTML =
            "<p class='text-center text-gray-600 text-xl'>Product not found.</p>";
          return;
        }

        selectedProduct = product;

        // Populate content
        document.getElementById("product-image").src = product.image;
        document.getElementById("product-name").textContent = product.name;
        document.getElementById("product-brand").textContent = "Brand: " + product.brand;
        document.getElementById("product-composition").textContent =
          "Composition: " + product.composition;
        document.getElementById("product-description").textContent = product.use;

        // Variants
        const variantsDiv = document.getElementById("product-variants");
        variantsDiv.innerHTML = "";
        product.variants.forEach((variant, index) => {
          const div = document.createElement("div");
          div.classList.add(
            "border",
            "rounded-xl",
            "p-3",
            "flex",
            "justify-between",
            "items-center",
            "cursor-pointer",
            "hover:bg-blue-50"
          );
          div.innerHTML = `
            <span>${variant.pack}</span>
            <span class="font-semibold text-brand">USD ${variant.price_usd} / ₹${variant.price_inr}</span>
          `;
          div.addEventListener("click", () => selectVariant(index));
          variantsDiv.appendChild(div);
        });
      } catch (error) {
        console.error("Error loading product:", error);
      }
    }

    let selectedVariant = null;

    function selectVariant(index) {
      const product = selectedProduct;
      selectedVariant = product.variants[index];
      alert(`Selected: ${selectedVariant.pack} - USD ${selectedVariant.price_usd}`);
    }

    // Add to Cart
    function addToCart() {
      if (!selectedProduct) return alert("No product selected.");
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      const item = {
        name: selectedProduct.name,
        variant: selectedVariant ? selectedVariant.pack : "Default",
        price: selectedVariant ? selectedVariant.price_usd : selectedProduct.variants[0].price_usd,
        image: selectedProduct.image,
      };
      cart.push(item);
      localStorage.setItem("cart", JSON.stringify(cart));
      alert(`${item.name} (${item.variant}) added to cart!`);
    }

    // Razorpay Integration
    function buyNow() {
      if (!selectedProduct) return alert("Select a variant before purchasing.");

      const price =
        selectedVariant?.price_usd || selectedProduct.variants[0].price_usd;

      const options = {
        key: "rzp_test_yourKeyHere", // Replace with your actual Razorpay key
        amount: price * 100,
        currency: "USD",
        name: "Vital Elixir Globalist",
        description: selectedProduct.name,
        handler: function (response) {
          alert("Payment Successful! Payment ID: " + response.razorpay_payment_id);
        },
        theme: { color: "#0284c7" },
      };

      const rzp = new Razorpay(options);
      rzp.open();
    }

    // Load header and menu logic
    async function loadHeader() {
      const header = await fetch("header.html");
      document.getElementById("header-placeholder").innerHTML = await header.text();

      const menuBtn = document.getElementById("menu-btn");
      const closeBtn = document.getElementById("close-menu");
      const mobileMenu = document.getElementById("mobile-menu");
      const sidebar = document.getElementById("sidebar");

      if (!menuBtn || !sidebar || !mobileMenu) return;

      menuBtn.addEventListener("click", () => {
        mobileMenu.classList.remove("hidden");
        setTimeout(() => sidebar.classList.remove("translate-x-full"), 10);
      });

      closeBtn.addEventListener("click", () => {
        sidebar.classList.add("translate-x-full");
        setTimeout(() => mobileMenu.classList.add("hidden"), 300);
      });

      mobileMenu.addEventListener("click", (e) => {
        if (e.target === mobileMenu) {
          sidebar.classList.add("translate-x-full");
          setTimeout(() => mobileMenu.classList.add("hidden"), 300);
        }
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadProductDetails();
      loadHeader();
    });
  </script>
</body>
</html>
